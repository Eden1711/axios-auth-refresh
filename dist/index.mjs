var k=(i,n)=>{let u=!1,c=[],l=(t,e=null)=>{c.forEach(r=>{t?r.reject(t):r.resolve(e)}),c=[]},h=(t,e)=>{t.headers.set("Authorization",`Bearer ${e}`)};i.interceptors.response.use(t=>t,async t=>{var r;let e=t.config;if(((r=t.response)==null?void 0:r.status)!==401||!e||e._retry)return Promise.reject(t);if(u)return new Promise(function(s,o){c.push({resolve:a=>{(n.attachTokenToRequest||h)(e,a),s(i(e))},reject:a=>{o(a)}})});e._retry=!0,u=!0;try{let s=n.getRefreshToken();if(!s)throw new Error("No refresh token available");let o=await n.requestRefresh(s);return n.onSuccess(o),(n.attachTokenToRequest||h)(e,o.accessToken),l(null,o.accessToken),i(e)}catch(s){return l(s,null),n.onFailure(s),Promise.reject(s)}finally{u=!1}})};export{k as applyAuthTokenInterceptor};
//# sourceMappingURL=index.mjs.map